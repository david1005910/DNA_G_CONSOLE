# 메타데이터 기반 바이러스 분석 및 ML 학습 계획

## 1. 현재 데이터 구조 분석

### 1.1 테이블 구조

| 테이블 | 주요 컬럼 | 용도 |
|--------|-----------|------|
| `genetic_records` | `dna_sequence`, `source_metadata`, `occurrence_count` | 유니크 시퀀스 저장, 메타데이터 누적 |
| `raw_genetic_captures` | `dna_sequence`, `source_info`, `linked_record_id` | 모든 캡처 이력 저장 |

### 1.2 메타데이터 구조 (source_metadata)

JSON 배열 형식으로 NCBI 정보가 저장됨:

```json
["PX795148.1 Influenza A virus (A/chicken/Saudi Arabia/479-KSA_H9N2_Alqaseem-2023/2023(H9N2)) segment 8 ..."]
```

**추출 가능한 정보:**

- **Accession ID**: `PX795148.1`
- **바이러스 타입**: `Influenza A virus`
- **Subtype**: `H9N2`, `H3N2`
- **숙주(Host)**: `chicken`, `human`
- **지역(Location)**: `Saudi Arabia`, `New Jersey`
- **연도(Year)**: `2023`, `2025`
- **Gene Segment**: `segment 8`, `NS1`, `M1`, `NEP`

### 1.3 현재 데이터 통계

| 항목 | 값 |
|------|-----|
| 총 유니크 시퀀스 | 12,523개 |
| 바이러스 종류 | Influenza A, Norovirus GII, Chicken anemia virus 등 |
| 최대 occurrence_count | 13+ (동일 시퀀스가 여러 소스에서 발견) |

---

## 2. 동일 바이러스 식별 방법론

### 2.1 시퀀스 기반 동일성

```ml
동일 시퀀스 = 100% 일치
→ occurrence_count > 1인 레코드 = 다중 소스에서 발견된 동일 바이러스
```

**활용**: 범지역적 확산 추적, 클러스터 분석

### 2.2 메타데이터 기반 유사성

| 기준 | 설명 | 동일성 판단 |
|------|------|------------|
| Accession ID | NCBI 고유 식별자 | 정확히 동일한 제출물 |
| 바이러스명 + Subtype | `Influenza A (H3N2)` | 같은 계통 |
| 지역 + 연도 | `New Jersey/2025` | 동일 발생 이벤트 가능성 |
| Gene Segment | `segment 8 NS1` | 기능적 유사성 |

### 2.3 하이브리드 접근

```ml
[시퀀스 유사도] + [메타데이터 매칭] → 종합 동일성 점수
```

---

## 3. ML 학습 방향 제안

### 3.1 옵션 A: 기존 임베딩 재학습 (Sequence-Based)

**목표**: DNA 시퀀스의 생물학적 특성 학습

| 학습 대상 | 방법 |
|-----------|------|
| GC Content | 뉴클레오티드 조성 분석 |
| K-mer Distribution | 3-mer, 4-mer 패턴 추출 |
| Codon Usage | 코돈 사용 빈도 학습 |
| Sequence Complexity | 엔트로피 기반 복잡도 |

**결과물**: 시퀀스 간 유사도 측정, 클러스터링

---

### 3.2 옵션 B: 메타데이터 기반 학습 (NLP + Structured)

**목표**: 텍스트 메타데이터에서 의미 추출

#### Step 1: 메타데이터 파싱 & 구조화

```python
{
    "accession": "PX795148.1",
    "virus_type": "Influenza A",
    "subtype": "H9N2",
    "host": "chicken",
    "location": "Saudi Arabia",
    "year": 2023,
    "gene": "NS1"
}
```

#### Step 2: 학습 가능한 태스크

| 태스크 | 설명 | 활용 |
|--------|------|------|
| 바이러스 분류 | 시퀀스 → 바이러스 타입 예측 | 미지 시퀀스 식별 |
| 숙주 예측 | 시퀀스 → 숙주 동물 예측 | 종간 전파 위험 평가 |
| 지역 클러스터링 | 지역별 변이 패턴 분석 | 확산 경로 추적 |
| 시간 분석 | 연도별 변이 추세 | 진화 속도 예측 |

---

## 4. 제안 서비스 기능

### 4.1 사이드바 > 엔진 분석 > 바이러스 동일성 분석

```
┌─────────────────────────────────────┐
│  🧬 바이러스 동일성 분석            │
├─────────────────┬───────────────────┤
│  [시퀀스 기반]  │  [메타데이터 기반] │
│   재학습 시작   │    분석 시작      │
├─────────────────┴───────────────────┤
│                                     │
│  ▼ 분석 결과                        │
│  ┌─────────────────────────────┐   │
│  │ • 동일 시퀀스 그룹: 847개    │   │
│  │ • 가장 많이 발견: H3N2 (32%) │   │
│  │ • 범지역 확산: 5건 감지      │   │
│  └─────────────────────────────┘   │
│                                     │
│  [상세 보고서 생성]                 │
└─────────────────────────────────────┘
```

### 4.2 기능 상세

| 기능 | 설명 |
|------|------|
| **시퀀스 재학습** | k-mer, 조성 기반 임베딩 업데이트 |
| **메타데이터 분석** | 숙주/지역/연도별 분포 분석 |
| **동일성 리포트** | occurrence_count 기반 클러스터 시각화 |
| **확산 추적** | 지역-시간 기반 확산 경로 시각화 |

---

## 5. 구현 우선순위

### Phase 1: 메타데이터 파서 구현

- [ ] `source_metadata` JSON 파싱
- [ ] 구조화된 필드 추출 (virus_type, host, location, year, gene)

### Phase 2: 분석 API 개발

- [ ] `/api/analysis/virus-identity` 엔드포인트
- [ ] occurrence_count 기반 그룹핑

### Phase 3: UI 컴포넌트

- [ ] 사이드바 > 엔진 분석 > 새 섹션 추가
- [ ] 2단 버튼 레이아웃 (시퀀스 기반 / 메타데이터 기반)

### Phase 4: 시각화

- [ ] 바이러스 타입별 분포 차트
- [ ] 지역별 발생 지도 (선택)

---

## 6. 예상 결과물

| 서비스 | 가치 |
|--------|------|
| **동일 바이러스 추적** | 범지역 확산 모니터링 |
| **숙주 예측 모델** | 종간 전파 위험 사전 감지 |
| **시간 분석** | 계절성 패턴, 변이 속도 예측 |
| **클러스터 분석** | 아웃브레이크 조기 감지 |

---

*작성일: 2026-01-07*
